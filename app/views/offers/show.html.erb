<div class="banner-offer-show" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://images.pexels.com/photos/1571451/pexels-photo-1571451.jpeg)">

 <div class="container-show">
    <h4 class="text-center"><strong><%= @offer.title %></strong></h4>
    <p><%= @offer.description %></p>

    <div class="form-actions mb-4 d-flex gap-2">
      <% if current_user == @offer.user %>
        <%= link_to "Edit Offer", edit_offer_path(@offer), class: "btn btn-primary" %>
        <%= button_to "Delete offer", offer_path(@offer),
            method: :delete,
            data: { confirm: "Are you sure?" },
            class: "btn btn-danger" %>
      <% else %>
        <%= link_to "Book this flat", new_offer_booking_path(@offer), class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>

  <div data-controller="map"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
    data-map-marker-value="<%= { lng: @offer.longitude, lat: @offer.latitude }.to_json %>"
    style='width: 100%; height: 300px;'>
  </div>

  <h5 class="mt-4">Reviews</h5>

  <% @offer.reviews.each do |review| %>
    <div class="card p-3 mb-3">
      <div class="d-flex justify-content-between align-items-center mb-1">
        <strong><%= review.user.first_name.capitalize %> <%= review.user.last_name.capitalize %></strong>
        <span class="badge bg-success">Rating: <%= review.rating %>/5</span>
      </div>
      <p class="mb-2"><%= review.comment %></p>

      <% if current_user == review.user %>
        <div class="d-flex gap-2">
          <%= link_to "Edit", "#", class: "btn btn-outline-primary btn-sm", data: { bs_toggle: "collapse", bs_target: "#edit-review-#{review.id}" } %>
          <%= button_to "Delete", offer_review_path(@offer, review), method: :delete, onclick: "return confirm('Are you sure you want to delete this review?')", class: "btn btn-outline-danger btn-sm" %>
        </div>

        <div id="edit-review-<%= review.id %>" class="collapse mt-2">
          <%= simple_form_for [@offer, review], html: { class: "border rounded p-3" } do |f| %>
            <%= f.input :rating, label: "Update Rating" %>
            <%= f.input :comment, label: "Update Comment" %>
            <%= f.submit "Save changes", class: "btn btn-sm btn-success" %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if policy(@review).create? && !@offer.reviews.exists?(user: current_user) %>
    <div class="mt-4">
      <h6>Leave a review:</h6>
      <%= simple_form_for [@offer, @review] do |f| %>
        <%= f.input :rating, input_html: { min: 1, max: 5, type: "number" } %>
        <%= f.input :comment %>
        <%= f.submit "Submit review", class: "btn btn-primary" %>
      <% end %>
    </div>
  <% end %>

  <%= link_to "Back to the home page", root_path, class: "btn btn-secondary mt-4" %>
</div>
